{"ast":null,"code":"var _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.refreshToken = exports.SignOut = exports.SignIn = void 0;\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _types = require(\"./types\");\n\nvar _auth = _interopRequireDefault(require(\"../services/auth\"));\n\nvar _storages = _interopRequireDefault(require(\"../services/storages\"));\n\nvar _decode = _interopRequireDefault(require(\"../services/decode\"));\n\nvar _eventsService = _interopRequireDefault(require(\"../services/eventsService\"));\n\nvar SignIn = function SignIn(token, codeverifier) {\n  return function (dispatch) {\n    _auth.default.onSignIn(token, codeverifier).then(function (token) {\n      var user = _decode.default.jwt(token.idToken);\n\n      _eventsService.default.transferMemberData(user).then(function (res) {\n        if (res.status === 200) {\n          _storages.default.save('user', JSON.stringify({\n            accessToken: token.accessToken,\n            refreshToken: token.refreshToken,\n            idToken: token.idToken\n          }));\n\n          dispatch({\n            type: _types.SIGN_IN_SUCCESS,\n            payload: {\n              user: user,\n              hasMember: res.data.hasMember\n            }\n          });\n        }\n      }).catch(function (e) {\n        console.log(e);\n        dispatch({\n          type: _types.SIGN_IN_FAIL,\n          payload: e\n        });\n      });\n    }).catch(function (e) {\n      console.log(e);\n      dispatch({\n        type: _types.SIGN_IN_FAIL,\n        payload: e\n      });\n    });\n  };\n};\n\nexports.SignIn = SignIn;\n\nvar SignOut = function SignOut() {\n  return function (dispatch) {\n    try {\n      _storages.default.remove('user');\n\n      dispatch({\n        type: _types.SIGN_OUT\n      });\n      dispatch({\n        type: _types.REMOVE_USER\n      });\n    } catch (e) {\n      console.log(\"SignOutError: \" + e);\n    }\n  };\n};\n\nexports.SignOut = SignOut;\n\nvar refreshToken = function refreshToken() {\n  return function (dispatch) {\n    console.log(\"REFRESH!!\");\n\n    _auth.default.onRefreshToken().then(function () {\n      var _ref = (0, _asyncToGenerator2.default)(function* (res) {\n        var _res$data = res.data,\n            access_token = _res$data.access_token,\n            id_token = _res$data.id_token,\n            refresh_token = _res$data.refresh_token;\n        yield _storages.default.save('user', JSON.stringify({\n          accessToken: access_token,\n          refreshToken: refresh_token,\n          idToken: id_token\n        }));\n        yield dispatch({\n          type: _types.REFRESH_TOKEN\n        });\n      });\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }());\n  };\n};\n\nexports.refreshToken = refreshToken;","map":{"version":3,"names":["SignIn","token","codeverifier","dispatch","Auth","onSignIn","then","user","decode","jwt","idToken","eventsService","transferMemberData","res","status","storages","save","JSON","stringify","accessToken","refreshToken","type","SIGN_IN_SUCCESS","payload","hasMember","data","catch","e","console","log","SIGN_IN_FAIL","SignOut","remove","SIGN_OUT","REMOVE_USER","onRefreshToken","access_token","id_token","refresh_token","REFRESH_TOKEN"],"sources":["C:/Users/bew_s/Documents/vscodeProject/EventLoopAPP/actions/auth.js"],"sourcesContent":["import {SIGN_IN_SUCCESS, SIGN_IN_FAIL, SIGN_OUT, REMOVE_USER, REFRESH_TOKEN} from \"./types\";\r\nimport Auth from \"../services/auth\";\r\nimport storages from \"../services/storages\";\r\nimport decode from \"../services/decode\";\r\nimport eventsService from \"../services/eventsService\";\r\n\r\n\r\nexport const SignIn = (token, codeverifier) => (dispatch) => {\r\n  Auth.onSignIn(token, codeverifier).then(token => {\r\n    const user = decode.jwt(token.idToken)\r\n    eventsService.transferMemberData(user).then( res => {\r\n      if(res.status === 200){\r\n        storages.save('user', JSON.stringify({\r\n          accessToken: token.accessToken,\r\n          refreshToken: token.refreshToken,\r\n          idToken: token.idToken\r\n        }))\r\n        dispatch({\r\n          type: SIGN_IN_SUCCESS,\r\n          payload: {user: user, hasMember: res.data.hasMember},\r\n        })\r\n      }\r\n    }).catch(e => {\r\n      console.log(e)\r\n      dispatch({\r\n        type: SIGN_IN_FAIL,\r\n        payload: e\r\n      })\r\n    })\r\n  }).catch(e => {\r\n    console.log(e)\r\n    dispatch({\r\n      type: SIGN_IN_FAIL,\r\n      payload: e\r\n    })\r\n  })\r\n}\r\n\r\nexport const SignOut = () => (dispatch) => {\r\n  try {\r\n    storages.remove('user')\r\n    dispatch({\r\n      type: SIGN_OUT\r\n    })\r\n    dispatch({\r\n      type: REMOVE_USER\r\n    })\r\n  } catch (e) {\r\n    console.log(\"SignOutError: \" + e)\r\n  }\r\n}\r\n\r\nexport const refreshToken = () => (dispatch) => {\r\n  console.log(\"REFRESH!!\")\r\n  Auth.onRefreshToken().then(async res => {\r\n    const {access_token,id_token,refresh_token} = res.data\r\n    await storages.save('user', JSON.stringify({\r\n      accessToken: access_token,\r\n      refreshToken: refresh_token,\r\n      idToken: id_token\r\n    }))\r\n    await dispatch({\r\n      type: REFRESH_TOKEN\r\n    })\r\n  })\r\n}\r\n"],"mappings":";;;;;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;AAGO,IAAMA,MAAM,GAAG,SAATA,MAAS,CAACC,KAAD,EAAQC,YAAR;EAAA,OAAyB,UAACC,QAAD,EAAc;IAC3DC,aAAA,CAAKC,QAAL,CAAcJ,KAAd,EAAqBC,YAArB,EAAmCI,IAAnC,CAAwC,UAAAL,KAAK,EAAI;MAC/C,IAAMM,IAAI,GAAGC,eAAA,CAAOC,GAAP,CAAWR,KAAK,CAACS,OAAjB,CAAb;;MACAC,sBAAA,CAAcC,kBAAd,CAAiCL,IAAjC,EAAuCD,IAAvC,CAA6C,UAAAO,GAAG,EAAI;QAClD,IAAGA,GAAG,CAACC,MAAJ,KAAe,GAAlB,EAAsB;UACpBC,iBAAA,CAASC,IAAT,CAAc,MAAd,EAAsBC,IAAI,CAACC,SAAL,CAAe;YACnCC,WAAW,EAAElB,KAAK,CAACkB,WADgB;YAEnCC,YAAY,EAAEnB,KAAK,CAACmB,YAFe;YAGnCV,OAAO,EAAET,KAAK,CAACS;UAHoB,CAAf,CAAtB;;UAKAP,QAAQ,CAAC;YACPkB,IAAI,EAAEC,sBADC;YAEPC,OAAO,EAAE;cAAChB,IAAI,EAAEA,IAAP;cAAaiB,SAAS,EAAEX,GAAG,CAACY,IAAJ,CAASD;YAAjC;UAFF,CAAD,CAAR;QAID;MACF,CAZD,EAYGE,KAZH,CAYS,UAAAC,CAAC,EAAI;QACZC,OAAO,CAACC,GAAR,CAAYF,CAAZ;QACAxB,QAAQ,CAAC;UACPkB,IAAI,EAAES,mBADC;UAEPP,OAAO,EAAEI;QAFF,CAAD,CAAR;MAID,CAlBD;IAmBD,CArBD,EAqBGD,KArBH,CAqBS,UAAAC,CAAC,EAAI;MACZC,OAAO,CAACC,GAAR,CAAYF,CAAZ;MACAxB,QAAQ,CAAC;QACPkB,IAAI,EAAES,mBADC;QAEPP,OAAO,EAAEI;MAFF,CAAD,CAAR;IAID,CA3BD;EA4BD,CA7BqB;AAAA,CAAf;;;;AA+BA,IAAMI,OAAO,GAAG,SAAVA,OAAU;EAAA,OAAM,UAAC5B,QAAD,EAAc;IACzC,IAAI;MACFY,iBAAA,CAASiB,MAAT,CAAgB,MAAhB;;MACA7B,QAAQ,CAAC;QACPkB,IAAI,EAAEY;MADC,CAAD,CAAR;MAGA9B,QAAQ,CAAC;QACPkB,IAAI,EAAEa;MADC,CAAD,CAAR;IAGD,CARD,CAQE,OAAOP,CAAP,EAAU;MACVC,OAAO,CAACC,GAAR,CAAY,mBAAmBF,CAA/B;IACD;EACF,CAZsB;AAAA,CAAhB;;;;AAcA,IAAMP,YAAY,GAAG,SAAfA,YAAe;EAAA,OAAM,UAACjB,QAAD,EAAc;IAC9CyB,OAAO,CAACC,GAAR,CAAY,WAAZ;;IACAzB,aAAA,CAAK+B,cAAL,GAAsB7B,IAAtB;MAAA,2CAA2B,WAAMO,GAAN,EAAa;QACtC,gBAA8CA,GAAG,CAACY,IAAlD;QAAA,IAAOW,YAAP,aAAOA,YAAP;QAAA,IAAoBC,QAApB,aAAoBA,QAApB;QAAA,IAA6BC,aAA7B,aAA6BA,aAA7B;QACA,MAAMvB,iBAAA,CAASC,IAAT,CAAc,MAAd,EAAsBC,IAAI,CAACC,SAAL,CAAe;UACzCC,WAAW,EAAEiB,YAD4B;UAEzChB,YAAY,EAAEkB,aAF2B;UAGzC5B,OAAO,EAAE2B;QAHgC,CAAf,CAAtB,CAAN;QAKA,MAAMlC,QAAQ,CAAC;UACbkB,IAAI,EAAEkB;QADO,CAAD,CAAd;MAGD,CAVD;;MAAA;QAAA;MAAA;IAAA;EAWD,CAb2B;AAAA,CAArB"},"metadata":{},"sourceType":"script"}