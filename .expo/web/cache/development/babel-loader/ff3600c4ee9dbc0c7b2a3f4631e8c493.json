{"ast":null,"code":"var _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.requestAsync = requestAsync;\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _expoModulesCore = require(\"expo-modules-core\");\n\nvar _qs = _interopRequireDefault(require(\"qs\"));\n\nvar _window$document;\n\nvar isDOMAvailable = _expoModulesCore.Platform.OS === 'web' && typeof window !== 'undefined' && !!((_window$document = window.document) != null && _window$document.createElement) && typeof URL !== 'undefined';\n\nfunction requestAsync(_x, _x2) {\n  return _requestAsync.apply(this, arguments);\n}\n\nfunction _requestAsync() {\n  _requestAsync = (0, _asyncToGenerator2.default)(function* (requestUrl, fetchRequest) {\n    var _fetchRequest$dataTyp;\n\n    if (_expoModulesCore.Platform.OS === 'web' && !isDOMAvailable) {\n      return;\n    }\n\n    var url = new URL(requestUrl);\n    var request = {\n      method: fetchRequest.method,\n      mode: 'cors',\n      headers: {}\n    };\n    var isJsonDataType = ((_fetchRequest$dataTyp = fetchRequest.dataType) == null ? void 0 : _fetchRequest$dataTyp.toLowerCase()) === 'json';\n\n    if (fetchRequest.headers) {\n      for (var i in fetchRequest.headers) {\n        if (i in fetchRequest.headers) {\n          request.headers[i] = fetchRequest.headers[i];\n        }\n      }\n    }\n\n    if (fetchRequest.body) {\n      var _fetchRequest$method;\n\n      if (((_fetchRequest$method = fetchRequest.method) == null ? void 0 : _fetchRequest$method.toUpperCase()) === 'POST') {\n        request.body = _qs.default.stringify(fetchRequest.body);\n      } else {\n        for (var key of Object.keys(fetchRequest.body)) {\n          url.searchParams.append(key, fetchRequest.body[key]);\n        }\n      }\n    }\n\n    if (isJsonDataType && !('Accept' in request.headers)) {\n      request.headers['Accept'] = 'application/json, text/javascript; q=0.01';\n    }\n\n    var correctedUrl = url.toString().replace(/\\/$/, '');\n    var response = yield fetch(correctedUrl, request);\n    var contentType = response.headers.get('content-type');\n\n    if (isJsonDataType || contentType != null && contentType.includes('application/json')) {\n      return response.json();\n    }\n\n    return response.text();\n  });\n  return _requestAsync.apply(this, arguments);\n}","map":{"version":3,"sources":["../src/Fetch.ts"],"names":[],"mappings":";;;;;;;;;AAAA;;AACA;;;;AAgBA,IAAM,cAAc,GAClB,yBAAA,CAAS,EAAT,KAAgB,KAAhB,IACA,OAAO,MAAP,KAAkB,WADlB,IAEA,CAAC,sBAAC,MAAM,CAAC,QAAR,aAAC,iBAAiB,aAAlB,CAFD,IAGA,OAAO,GAAP,KAAe,WAJjB;;SAMsB,Y;;;;;kDAAf,WAA+B,UAA/B,EAAmD,YAAnD,EAA6E;IAAA;;IAClF,IAAI,yBAAA,CAAS,EAAT,KAAgB,KAAhB,IAAyB,CAAC,cAA9B,EAA8C;MAE5C;IACD;;IACD,IAAM,GAAG,GAAG,IAAI,GAAJ,CAAQ,UAAR,CAAZ;IAEA,IAAM,OAAO,GAA4D;MACvE,MAAM,EAAE,YAAY,CAAC,MADkD;MAEvE,IAAI,EAAE,MAFiE;MAGvE,OAAO,EAAE;IAH8D,CAAzE;IAMA,IAAM,cAAc,GAAG,0BAAA,YAAY,CAAC,QAAb,2CAAuB,WAAvB,QAAyC,MAAhE;;IAEA,IAAI,YAAY,CAAC,OAAjB,EAA0B;MACxB,KAAK,IAAM,CAAX,IAAgB,YAAY,CAAC,OAA7B,EAAsC;QACpC,IAAI,CAAC,IAAI,YAAY,CAAC,OAAtB,EAA+B;UAC7B,OAAO,CAAC,OAAR,CAAgB,CAAhB,IAAqB,YAAY,CAAC,OAAb,CAAqB,CAArB,CAArB;QACD;MACF;IACF;;IAED,IAAI,YAAY,CAAC,IAAjB,EAAuB;MAAA;;MACrB,IAAI,yBAAA,YAAY,CAAC,MAAb,0CAAqB,WAArB,QAAuC,MAA3C,EAAmD;QACjD,OAAO,CAAC,IAAR,GAAe,WAAA,CAAG,SAAH,CAAa,YAAY,CAAC,IAA1B,CAAf;MACD,CAFD,MAEO;QACL,KAAK,IAAM,GAAX,IAAkB,MAAM,CAAC,IAAP,CAAY,YAAY,CAAC,IAAzB,CAAlB,EAAkD;UAChD,GAAG,CAAC,YAAJ,CAAiB,MAAjB,CAAwB,GAAxB,EAA6B,YAAY,CAAC,IAAb,CAAkB,GAAlB,CAA7B;QACD;MACF;IACF;;IAED,IAAI,cAAc,IAAI,EAAE,YAAY,OAAO,CAAC,OAAtB,CAAtB,EAAsD;MAEpD,OAAO,CAAC,OAAR,CAAgB,QAAhB,IAA4B,2CAA5B;IACD;;IAGD,IAAM,YAAY,GAAG,GAAG,CAAC,QAAJ,GAAe,OAAf,CAAuB,KAAvB,EAA8B,EAA9B,CAArB;IAEA,IAAM,QAAQ,SAAS,KAAK,CAAC,YAAD,EAAe,OAAf,CAA5B;IAEA,IAAM,WAAW,GAAG,QAAQ,CAAC,OAAT,CAAiB,GAAjB,CAAqB,cAArB,CAApB;;IACA,IAAI,cAAc,IAAI,WAAJ,YAAI,WAAW,CAAE,QAAb,CAAsB,kBAAtB,CAAtB,EAAiE;MAC/D,OAAO,QAAQ,CAAC,IAAT,EAAP;IACD;;IAED,OAAO,QAAQ,CAAC,IAAT,EAAP;EACD,C","sourcesContent":["import { Platform } from 'expo-modules-core';\nimport qs from 'qs';\n\nexport type Headers = Record<string, string> & {\n  'Content-Type': string;\n  Authorization?: string;\n  Accept?: string;\n};\n\nexport type FetchRequest = {\n  headers?: Headers;\n  body?: Record<string, string>;\n  dataType?: string;\n  method?: string;\n};\n\n// TODO(Bacon): pending react-native-adapter publish after sdk 38\nconst isDOMAvailable =\n  Platform.OS === 'web' &&\n  typeof window !== 'undefined' &&\n  !!window.document?.createElement &&\n  typeof URL !== 'undefined';\n\nexport async function requestAsync<T>(requestUrl: string, fetchRequest: FetchRequest): Promise<T> {\n  if (Platform.OS === 'web' && !isDOMAvailable) {\n    // @ts-ignore\n    return;\n  }\n  const url = new URL(requestUrl);\n\n  const request: Omit<RequestInit, 'headers'> & { headers: HeadersInit } = {\n    method: fetchRequest.method,\n    mode: 'cors',\n    headers: {},\n  };\n\n  const isJsonDataType = fetchRequest.dataType?.toLowerCase() === 'json';\n\n  if (fetchRequest.headers) {\n    for (const i in fetchRequest.headers) {\n      if (i in fetchRequest.headers) {\n        request.headers[i] = fetchRequest.headers[i] as string;\n      }\n    }\n  }\n\n  if (fetchRequest.body) {\n    if (fetchRequest.method?.toUpperCase() === 'POST') {\n      request.body = qs.stringify(fetchRequest.body);\n    } else {\n      for (const key of Object.keys(fetchRequest.body)) {\n        url.searchParams.append(key, fetchRequest.body[key]);\n      }\n    }\n  }\n\n  if (isJsonDataType && !('Accept' in request.headers)) {\n    // NOTE: Github authentication will return XML if this includes the standard `*/*`\n    request.headers['Accept'] = 'application/json, text/javascript; q=0.01';\n  }\n\n  // Fix a problem with React Native `URL` causing a trailing slash to be added.\n  const correctedUrl = url.toString().replace(/\\/$/, '');\n\n  const response = await fetch(correctedUrl, request);\n\n  const contentType = response.headers.get('content-type');\n  if (isJsonDataType || contentType?.includes('application/json')) {\n    return response.json();\n  }\n  // @ts-ignore: Type 'string' is not assignable to type 'T'.\n  return response.text();\n}\n"],"sourceRoot":""},"metadata":{},"sourceType":"script"}