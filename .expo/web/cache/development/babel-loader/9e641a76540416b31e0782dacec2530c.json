{"ast":null,"code":"var _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.refreshToken = exports.SignOut = exports.SignIn = void 0;\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _types = require(\"./types\");\n\nvar _auth = _interopRequireDefault(require(\"../services/auth\"));\n\nvar _storages = _interopRequireDefault(require(\"../services/storages\"));\n\nvar _decode = _interopRequireDefault(require(\"../services/decode\"));\n\nvar _eventsService = _interopRequireDefault(require(\"../services/eventsService\"));\n\nvar SignIn = function SignIn(token, codeverifier) {\n  return function (dispatch) {\n    _auth.default.onSignIn(token, codeverifier).then(function (token) {\n      var user = _decode.default.jwt(token.idToken);\n\n      dispatch({\n        type: _types.SIGN_IN_SUCCESS,\n        payload: {\n          user: user\n        }\n      });\n    }).catch(function (e) {\n      console.log(e);\n      dispatch({\n        type: _types.SIGN_IN_FAIL,\n        payload: e\n      });\n    });\n  };\n};\n\nexports.SignIn = SignIn;\n\nvar SignOut = function SignOut() {\n  return function (dispatch) {\n    try {\n      _storages.default.remove('user');\n\n      dispatch({\n        type: _types.SIGN_OUT\n      });\n      dispatch({\n        type: _types.REMOVE_USER\n      });\n    } catch (e) {\n      console.log(\"SignOutError: \" + e);\n    }\n  };\n};\n\nexports.SignOut = SignOut;\n\nvar refreshToken = function refreshToken() {\n  return function (dispatch) {\n    console.log(\"REFRESH!!\");\n\n    _auth.default.onRefreshToken().then(function () {\n      var _ref = (0, _asyncToGenerator2.default)(function* (res) {\n        var _res$data = res.data,\n            access_token = _res$data.access_token,\n            id_token = _res$data.id_token,\n            refresh_token = _res$data.refresh_token;\n        yield _storages.default.save('user', JSON.stringify({\n          accessToken: access_token,\n          refreshToken: refresh_token,\n          idToken: id_token\n        }));\n        yield dispatch({\n          type: _types.REFRESH_TOKEN\n        });\n      });\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }());\n  };\n};\n\nexports.refreshToken = refreshToken;","map":{"version":3,"names":["SignIn","token","codeverifier","dispatch","Auth","onSignIn","then","user","decode","jwt","idToken","type","SIGN_IN_SUCCESS","payload","catch","e","console","log","SIGN_IN_FAIL","SignOut","storages","remove","SIGN_OUT","REMOVE_USER","refreshToken","onRefreshToken","res","data","access_token","id_token","refresh_token","save","JSON","stringify","accessToken","REFRESH_TOKEN"],"sources":["C:/Users/APIWATSRINUKUL/Desktop/EventLoopAPP/actions/auth.js"],"sourcesContent":["import {SIGN_IN_SUCCESS, SIGN_IN_FAIL, SIGN_OUT, REMOVE_USER, REFRESH_TOKEN} from \"./types\";\r\nimport Auth from \"../services/auth\";\r\nimport storages from \"../services/storages\";\r\nimport decode from \"../services/decode\";\r\nimport eventsService from \"../services/eventsService\";\r\n\r\n\r\nexport const SignIn = (token, codeverifier) => (dispatch) => {\r\n  Auth.onSignIn(token, codeverifier).then(token => {\r\n    const user = decode.jwt(token.idToken)\r\n    dispatch({type: SIGN_IN_SUCCESS, payload: {user: user}})\r\n    // eventsService.transferMemberData(user).then( res => {\r\n    //   if(res.status === 200){\r\n    //     storages.save('user', JSON.stringify({\r\n    //       accessToken: token.accessToken,\r\n    //       refreshToken: token.refreshToken,\r\n    //       idToken: token.idToken\r\n    //     }))\r\n    //     dispatch({\r\n    //       type: SIGN_IN_SUCCESS,\r\n    //       payload: {user: user, hasMember: res.data.hasMember},\r\n    //     })\r\n    //   }\r\n    // }).catch(e => {\r\n    //   console.log(e)\r\n    //   dispatch({\r\n    //     type: SIGN_IN_FAIL,\r\n    //     payload: e\r\n    //   })\r\n    // })\r\n  }).catch(e => {\r\n    console.log(e)\r\n    dispatch({\r\n      type: SIGN_IN_FAIL,\r\n      payload: e\r\n    })\r\n  })\r\n}\r\n\r\nexport const SignOut = () => (dispatch) => {\r\n  try {\r\n    storages.remove('user')\r\n    dispatch({\r\n      type: SIGN_OUT\r\n    })\r\n    dispatch({\r\n      type: REMOVE_USER\r\n    })\r\n  } catch (e) {\r\n    console.log(\"SignOutError: \" + e)\r\n  }\r\n}\r\n\r\nexport const refreshToken = () => (dispatch) => {\r\n  console.log(\"REFRESH!!\")\r\n  Auth.onRefreshToken().then(async res => {\r\n    const {access_token,id_token,refresh_token} = res.data\r\n    await storages.save('user', JSON.stringify({\r\n      accessToken: access_token,\r\n      refreshToken: refresh_token,\r\n      idToken: id_token\r\n    }))\r\n    await dispatch({\r\n      type: REFRESH_TOKEN\r\n    })\r\n  })\r\n}\r\n"],"mappings":";;;;;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;AAGO,IAAMA,MAAM,GAAG,SAATA,MAAS,CAACC,KAAD,EAAQC,YAAR;EAAA,OAAyB,UAACC,QAAD,EAAc;IAC3DC,aAAA,CAAKC,QAAL,CAAcJ,KAAd,EAAqBC,YAArB,EAAmCI,IAAnC,CAAwC,UAAAL,KAAK,EAAI;MAC/C,IAAMM,IAAI,GAAGC,eAAA,CAAOC,GAAP,CAAWR,KAAK,CAACS,OAAjB,CAAb;;MACAP,QAAQ,CAAC;QAACQ,IAAI,EAAEC,sBAAP;QAAwBC,OAAO,EAAE;UAACN,IAAI,EAAEA;QAAP;MAAjC,CAAD,CAAR;IAoBD,CAtBD,EAsBGO,KAtBH,CAsBS,UAAAC,CAAC,EAAI;MACZC,OAAO,CAACC,GAAR,CAAYF,CAAZ;MACAZ,QAAQ,CAAC;QACPQ,IAAI,EAAEO,mBADC;QAEPL,OAAO,EAAEE;MAFF,CAAD,CAAR;IAID,CA5BD;EA6BD,CA9BqB;AAAA,CAAf;;;;AAgCA,IAAMI,OAAO,GAAG,SAAVA,OAAU;EAAA,OAAM,UAAChB,QAAD,EAAc;IACzC,IAAI;MACFiB,iBAAA,CAASC,MAAT,CAAgB,MAAhB;;MACAlB,QAAQ,CAAC;QACPQ,IAAI,EAAEW;MADC,CAAD,CAAR;MAGAnB,QAAQ,CAAC;QACPQ,IAAI,EAAEY;MADC,CAAD,CAAR;IAGD,CARD,CAQE,OAAOR,CAAP,EAAU;MACVC,OAAO,CAACC,GAAR,CAAY,mBAAmBF,CAA/B;IACD;EACF,CAZsB;AAAA,CAAhB;;;;AAcA,IAAMS,YAAY,GAAG,SAAfA,YAAe;EAAA,OAAM,UAACrB,QAAD,EAAc;IAC9Ca,OAAO,CAACC,GAAR,CAAY,WAAZ;;IACAb,aAAA,CAAKqB,cAAL,GAAsBnB,IAAtB;MAAA,2CAA2B,WAAMoB,GAAN,EAAa;QACtC,gBAA8CA,GAAG,CAACC,IAAlD;QAAA,IAAOC,YAAP,aAAOA,YAAP;QAAA,IAAoBC,QAApB,aAAoBA,QAApB;QAAA,IAA6BC,aAA7B,aAA6BA,aAA7B;QACA,MAAMV,iBAAA,CAASW,IAAT,CAAc,MAAd,EAAsBC,IAAI,CAACC,SAAL,CAAe;UACzCC,WAAW,EAAEN,YAD4B;UAEzCJ,YAAY,EAAEM,aAF2B;UAGzCpB,OAAO,EAAEmB;QAHgC,CAAf,CAAtB,CAAN;QAKA,MAAM1B,QAAQ,CAAC;UACbQ,IAAI,EAAEwB;QADO,CAAD,CAAd;MAGD,CAVD;;MAAA;QAAA;MAAA;IAAA;EAWD,CAb2B;AAAA,CAArB"},"metadata":{},"sourceType":"script"}