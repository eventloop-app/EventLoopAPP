{"ast":null,"code":"var _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _api = _interopRequireDefault(require(\"./api\"));\n\nvar _storages = _interopRequireDefault(require(\"./storages\"));\n\nvar _auth = require(\"../actions/auth\");\n\nvar setup = function setup(store) {\n  _api.default.interceptors.request.use(function () {\n    var _ref = (0, _asyncToGenerator2.default)(function* (config) {\n      yield _storages.default.getDataV2('user').then(function (res) {\n        if (res !== undefined) {\n          config.headers[\"Authorization\"] = JSON.parse(res).idToken;\n          config.headers[\"content-type\"] = 'application/json';\n        }\n      });\n      return config;\n    });\n\n    return function (_x) {\n      return _ref.apply(this, arguments);\n    };\n  }(), function (error) {\n    return Promise.reject(error);\n  });\n\n  var dispatch = store.dispatch;\n\n  _api.default.interceptors.response.use(function (res) {\n    return res;\n  }, function () {\n    var _ref2 = (0, _asyncToGenerator2.default)(function* (err) {\n      var originalConfig = err.config;\n\n      if (originalConfig.url !== \"login\" && err.response) {\n        if (err.response.status === 401 && !originalConfig._retry && err.response.data.message !== 'JWT not present.') {\n          console.log('Token Exprice');\n          originalConfig._retry = true;\n          yield dispatch((0, _auth.refreshToken)());\n          yield _storages.default.getDataV2('user').then(function (res) {\n            originalConfig.headers.Authorization = JSON.parse(res).idToken;\n          });\n          return yield (0, _api.default)(originalConfig);\n        }\n      }\n\n      return Promise.reject({\n        message: 'มีบางอย่างผิดพลาด'\n      });\n    });\n\n    return function (_x2) {\n      return _ref2.apply(this, arguments);\n    };\n  }());\n};\n\nvar _default = setup;\nexports.default = _default;","map":{"version":3,"names":["setup","store","axiosInstance","interceptors","request","use","config","storages","getDataV2","then","res","undefined","headers","JSON","parse","idToken","error","Promise","reject","dispatch","response","err","originalConfig","url","status","_retry","data","message","console","log","refreshToken","Authorization"],"sources":["C:/Users/bew_s/Documents/vscodeProject/EventLoopAPP/services/interceptors.js"],"sourcesContent":["import axiosInstance from \"./api\";\r\nimport storages from \"./storages\";\r\nimport {refreshToken} from \"../actions/auth\";\r\n\r\nconst setup = (store) => {\r\n  axiosInstance.interceptors.request.use(async (config) => {\r\n    await storages.getDataV2('user').then(res => {\r\n      if (res !== undefined) {\r\n        config.headers[\"Authorization\"] = JSON.parse(res).idToken;\r\n        config.headers[\"content-type\"] = 'application/json';\r\n      }\r\n    });\r\n    return config;\r\n  }, (error) => {\r\n    return Promise.reject(error);\r\n  });\r\n  const {dispatch} = store;\r\n\r\n  axiosInstance.interceptors.response.use((res) => {\r\n    return res;\r\n  }, async (err) => {\r\n    const originalConfig = err.config;\r\n    if (originalConfig.url !== \"login\" && err.response) {\r\n      // Access Token was expired\r\n      if (err.response.status === 401 && !originalConfig._retry && err.response.data.message !== 'JWT not present.') {\r\n        console.log('Token Exprice')\r\n        originalConfig._retry = true;\r\n        await dispatch(refreshToken())\r\n        await storages.getDataV2('user').then(res => {\r\n          originalConfig.headers.Authorization = JSON.parse(res).idToken\r\n        })\r\n        return await axiosInstance(originalConfig);\r\n      }\r\n    }\r\n    return Promise.reject({message: 'มีบางอย่างผิดพลาด'});\r\n  });\r\n};\r\nexport default setup;\r\n"],"mappings":";;;;;;;;;AAAA;;AACA;;AACA;;AAEA,IAAMA,KAAK,GAAG,SAARA,KAAQ,CAACC,KAAD,EAAW;EACvBC,YAAA,CAAcC,YAAd,CAA2BC,OAA3B,CAAmCC,GAAnC;IAAA,2CAAuC,WAAOC,MAAP,EAAkB;MACvD,MAAMC,iBAAA,CAASC,SAAT,CAAmB,MAAnB,EAA2BC,IAA3B,CAAgC,UAAAC,GAAG,EAAI;QAC3C,IAAIA,GAAG,KAAKC,SAAZ,EAAuB;UACrBL,MAAM,CAACM,OAAP,CAAe,eAAf,IAAkCC,IAAI,CAACC,KAAL,CAAWJ,GAAX,EAAgBK,OAAlD;UACAT,MAAM,CAACM,OAAP,CAAe,cAAf,IAAiC,kBAAjC;QACD;MACF,CALK,CAAN;MAMA,OAAON,MAAP;IACD,CARD;;IAAA;MAAA;IAAA;EAAA,KAQG,UAACU,KAAD,EAAW;IACZ,OAAOC,OAAO,CAACC,MAAR,CAAeF,KAAf,CAAP;EACD,CAVD;;EAWA,IAAOG,QAAP,GAAmBlB,KAAnB,CAAOkB,QAAP;;EAEAjB,YAAA,CAAcC,YAAd,CAA2BiB,QAA3B,CAAoCf,GAApC,CAAwC,UAACK,GAAD,EAAS;IAC/C,OAAOA,GAAP;EACD,CAFD;IAAA,4CAEG,WAAOW,GAAP,EAAe;MAChB,IAAMC,cAAc,GAAGD,GAAG,CAACf,MAA3B;;MACA,IAAIgB,cAAc,CAACC,GAAf,KAAuB,OAAvB,IAAkCF,GAAG,CAACD,QAA1C,EAAoD;QAElD,IAAIC,GAAG,CAACD,QAAJ,CAAaI,MAAb,KAAwB,GAAxB,IAA+B,CAACF,cAAc,CAACG,MAA/C,IAAyDJ,GAAG,CAACD,QAAJ,CAAaM,IAAb,CAAkBC,OAAlB,KAA8B,kBAA3F,EAA+G;UAC7GC,OAAO,CAACC,GAAR,CAAY,eAAZ;UACAP,cAAc,CAACG,MAAf,GAAwB,IAAxB;UACA,MAAMN,QAAQ,CAAC,IAAAW,kBAAA,GAAD,CAAd;UACA,MAAMvB,iBAAA,CAASC,SAAT,CAAmB,MAAnB,EAA2BC,IAA3B,CAAgC,UAAAC,GAAG,EAAI;YAC3CY,cAAc,CAACV,OAAf,CAAuBmB,aAAvB,GAAuClB,IAAI,CAACC,KAAL,CAAWJ,GAAX,EAAgBK,OAAvD;UACD,CAFK,CAAN;UAGA,aAAa,IAAAb,YAAA,EAAcoB,cAAd,CAAb;QACD;MACF;;MACD,OAAOL,OAAO,CAACC,MAAR,CAAe;QAACS,OAAO,EAAE;MAAV,CAAf,CAAP;IACD,CAjBD;;IAAA;MAAA;IAAA;EAAA;AAkBD,CAhCD;;eAiCe3B,K"},"metadata":{},"sourceType":"script"}