{"ast":null,"code":"var _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _reactNative = require(\"react-native\");\n\nvar _expoAuthSession = require(\"expo-auth-session\");\n\nvar _reactRedux = require(\"react-redux\");\n\nvar _auth = require(\"../actions/auth\");\n\nvar _user = require(\"../actions/user\");\n\nvar _jwtDecode = _interopRequireDefault(require(\"jwt-decode\"));\n\nvar _decode = _interopRequireDefault(require(\"../services/decode\"));\n\nvar _Fonts = _interopRequireDefault(require(\"../constants/Fonts\"));\n\nvar _FontSize = _interopRequireDefault(require(\"../constants/FontSize\"));\n\nvar _SignInButtons = require(\"../components/SignInButtons\");\n\nvar _native = require(\"@react-navigation/native\");\n\nvar _eventsService = _interopRequireDefault(require(\"../services/eventsService\"));\n\nvar _this = this,\n    _jsxFileName = \"C:\\\\Users\\\\APIWATSRINUKUL\\\\Desktop\\\\EventLoopAPP\\\\screens\\\\ProfileScreen.js\";\n\nfunction _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== \"function\") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }\n\nfunction _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== \"object\" && typeof obj !== \"function\") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\nvar ProfileScreen = function ProfileScreen(_ref) {\n  var route = _ref.route,\n      navigation = _ref.navigation;\n\n  var _useState = (0, _react.useState)(true),\n      _useState2 = (0, _slicedToArray2.default)(_useState, 2),\n      isLoad = _useState2[0],\n      setIsLoad = _useState2[1];\n\n  var _useState3 = (0, _react.useState)(null),\n      _useState4 = (0, _slicedToArray2.default)(_useState3, 2),\n      userData = _useState4[0],\n      setUserData = _useState4[1];\n\n  var _useState5 = (0, _react.useState)(false),\n      _useState6 = (0, _slicedToArray2.default)(_useState5, 2),\n      isVisible = _useState6[0],\n      setIsVisible = _useState6[1];\n\n  var discovery = (0, _expoAuthSession.useAutoDiscovery)(\"https://login.microsoftonline.com/6f4432dc-20d2-441d-b1db-ac3380ba633d/v2.0\");\n  var redirectUri = (0, _expoAuthSession.makeRedirectUri)({\n    scheme: \"exp://fy-kbp.eventloop.eventloopapp.exp.direct:80\"\n  });\n  var dispatch = (0, _reactRedux.useDispatch)();\n\n  var _useSelector = (0, _reactRedux.useSelector)(function (state) {\n    return state.auth;\n  }),\n      authData = _useSelector.authData,\n      authDataError = _useSelector.authDataError;\n\n  var _useSelector2 = (0, _reactRedux.useSelector)(function (state) {\n    return state.user;\n  }),\n      userToken = _useSelector2.userToken,\n      userError = _useSelector2.userError;\n\n  (0, _react.useEffect)(function () {\n    console.log(\"Check Token\");\n    dispatch((0, _user.getUserToken)());\n  }, []);\n  (0, _react.useEffect)(function () {\n    if (authData !== null) {\n      _eventsService.default.checkEmail(authData.user.email).then(function (res) {\n        if (!res.data.hasEmail) {\n          navigation.navigate('EditProfile', {\n            user: authData.user\n          });\n        } else {}\n      });\n    }\n  }, [authData]);\n  (0, _react.useEffect)(function () {\n    if (userToken !== null) {\n      var idToken = JSON.parse(userToken).idToken;\n\n      var user = _decode.default.jwt(idToken);\n\n      setUserData(user);\n      console.log(user);\n    }\n\n    if (userError) {\n      console.log(\"userTokenErrorr : \" + userError);\n    }\n\n    setIsLoad(false);\n  }, [userToken]);\n\n  var _useAuthRequest = (0, _expoAuthSession.useAuthRequest)({\n    clientId: \"4bf4a100-9aeb-42be-8649-8fd4ef42722b\",\n    clientSecret: \"3~68Q~sLI_5IxI1m7m8PdKEP_XGT4xWXfXCdIdfG\",\n    scopes: [\"openid\", \"profile\", \"email\", \"offline_access\"],\n    responseType: \"code\",\n    prompt: \"login\",\n    redirectUri: redirectUri\n  }, discovery),\n      _useAuthRequest2 = (0, _slicedToArray2.default)(_useAuthRequest, 3),\n      request = _useAuthRequest2[0],\n      response = _useAuthRequest2[1],\n      promptAsync = _useAuthRequest2[2];\n\n  (0, _react.useEffect)(function () {\n    if (response && \"params\" in response) {\n      if (response.params && \"code\" in response.params) {\n        dispatch((0, _auth.SignIn)(response.params.code, request.codeVerifier));\n      }\n    }\n  }, [response]);\n\n  var signOut = function signOut() {\n    dispatch((0, _auth.SignOut)());\n    setUserData(null);\n  };\n\n  var renderProfile = function renderProfile() {\n    return _react.default.createElement(_reactNative.SafeAreaView, {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 117,\n        columnNumber: 9\n      }\n    }, _react.default.createElement(_reactNative.View, {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 118,\n        columnNumber: 13\n      }\n    }, _react.default.createElement(_reactNative.Text, {\n      style: styles.CenterScreenText,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 119,\n        columnNumber: 17\n      }\n    }, \"\\u0E04\\u0E38\\u0E13\\u0E22\\u0E31\\u0E07\\u0E44\\u0E21\\u0E48\\u0E44\\u0E14\\u0E49\\u0E40\\u0E02\\u0E49\\u0E32\\u0E2A\\u0E39\\u0E48\\u0E23\\u0E30\\u0E1A\\u0E1A\"), _react.default.createElement(_reactNative.Button, {\n      title: \"Sign in\",\n      onPress: function onPress() {\n        return promptAsync();\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 120,\n        columnNumber: 17\n      }\n    })));\n  };\n\n  return _react.default.createElement(_reactNative.SafeAreaView, {\n    style: styles.Container,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 129,\n      columnNumber: 9\n    }\n  }, isLoad ? _react.default.createElement(_reactNative.Text, {\n    style: styles.CenterScreenText,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 132,\n      columnNumber: 21\n    }\n  }, \"Loading...\") : renderProfile());\n};\n\nvar styles = _reactNative.StyleSheet.create({\n  Container: {\n    flex: 1,\n    alignItems: 'center',\n    justifyContent: 'center',\n    backgroundColor: 'white'\n  },\n  CenterScreenText: {\n    textAlign: 'center',\n    fontFamily: _Fonts.default.bold,\n    fontSize: _FontSize.default.primary\n  }\n});\n\nvar _default = ProfileScreen;\nexports.default = _default;","map":{"version":3,"names":["ProfileScreen","route","navigation","useState","isLoad","setIsLoad","userData","setUserData","isVisible","setIsVisible","discovery","useAutoDiscovery","redirectUri","makeRedirectUri","scheme","dispatch","useDispatch","useSelector","state","auth","authData","authDataError","user","userToken","userError","useEffect","console","log","getUserToken","eventsService","checkEmail","email","then","res","data","hasEmail","navigate","idToken","JSON","parse","decode","jwt","useAuthRequest","clientId","clientSecret","scopes","responseType","prompt","request","response","promptAsync","params","SignIn","code","codeVerifier","signOut","SignOut","renderProfile","styles","CenterScreenText","Container","StyleSheet","create","flex","alignItems","justifyContent","backgroundColor","textAlign","fontFamily","fonts","bold","fontSize","primary"],"sources":["C:/Users/APIWATSRINUKUL/Desktop/EventLoopAPP/screens/ProfileScreen.js"],"sourcesContent":["import React, {useCallback, useEffect, useState} from 'react';\r\nimport {Button, RefreshControl, SafeAreaView, StatusBar, StyleSheet, Text, View} from \"react-native\";\r\nimport {makeRedirectUri, useAuthRequest, useAutoDiscovery} from \"expo-auth-session\";\r\nimport {useDispatch, useSelector} from \"react-redux\";\r\nimport {SignIn, SignOut} from \"../actions/auth\";\r\nimport {getUserToken} from \"../actions/user\";\r\nimport jwt_decode from \"jwt-decode\";\r\nimport decode from \"../services/decode\";\r\nimport fonts from \"../constants/Fonts\";\r\nimport fontSize from \"../constants/FontSize\";\r\nimport {SignInButtons} from \"../components/SignInButtons\";\r\nimport {useFocusEffect} from '@react-navigation/native'\r\nimport eventsService from \"../services/eventsService\";\r\n\r\n\r\nconst ProfileScreen = ({route, navigation}) => {\r\n    const [isLoad, setIsLoad] = useState(true)\r\n    const [userData, setUserData] = useState(null)\r\n    const [isVisible, setIsVisible] = useState(false)\r\n    const discovery = useAutoDiscovery(\"https://login.microsoftonline.com/6f4432dc-20d2-441d-b1db-ac3380ba633d/v2.0\");\r\n    const redirectUri = makeRedirectUri({scheme: \"exp://fy-kbp.eventloop.eventloopapp.exp.direct:80\"});\r\n    const dispatch = useDispatch();\r\n\r\n    //ดึงข้อมูลตอน Login\r\n    const {authData, authDataError} = useSelector(state => state.auth)\r\n    //ดึงข้อมูลตอน User จาก Storage\r\n    const {userToken, userError} = useSelector(state => state.user)\r\n\r\n\r\n    // useFocusEffect(\r\n    //   useCallback(() => {\r\n    //     setIsVisible(true)\r\n    //     console.log('true')\r\n    //     return () => {\r\n    //       setIsVisible(false)\r\n    //       console.log('false')\r\n    //     }\r\n    //   }, [])\r\n    // )\r\n\r\n    // useEffect(() => {\r\n    //     const unsubscribe = navigation.addListener('focus', () => {\r\n    //         console.log(\"Profileeee\")\r\n    //     });\r\n    //     return unsubscribe;\r\n    // }, [navigation])\r\n\r\n    useEffect(() => {\r\n        console.log(\"Check Token\")\r\n        dispatch(getUserToken())\r\n    }, [])\r\n\r\n    useEffect( ()=> {\r\n        if(authData !== null){\r\n            eventsService.checkEmail(authData.user.email).then(res => {\r\n                if(!res.data.hasEmail){\r\n                    navigation.navigate('EditProfile', {user: authData.user})\r\n                }else {\r\n\r\n                }\r\n            })\r\n        }\r\n        // if (authData?.hasMember) {\r\n        //     navigation.navigate('EditProfile', {user: authData})\r\n        //     // setUserData(authData.user)\r\n        //\r\n        // }\r\n        // if (authDataError) {\r\n        //     console.log('Error:' + authDataError)\r\n        // }\r\n    }, [authData])\r\n\r\n    useEffect(() => {\r\n        if (userToken !== null) {\r\n            const idToken = JSON.parse(userToken).idToken\r\n            const user = decode.jwt(idToken)\r\n            setUserData(user)\r\n            console.log(user)\r\n        }\r\n        if (userError) {\r\n            console.log(\"userTokenErrorr : \" + userError)\r\n        }\r\n        setIsLoad(false)\r\n    }, [userToken])\r\n\r\n    const [request, response, promptAsync] = useAuthRequest(\r\n        {\r\n            clientId: \"4bf4a100-9aeb-42be-8649-8fd4ef42722b\",\r\n            clientSecret: \"3~68Q~sLI_5IxI1m7m8PdKEP_XGT4xWXfXCdIdfG\",\r\n            scopes: [\"openid\", \"profile\", \"email\", \"offline_access\"],\r\n            responseType: \"code\",\r\n            prompt: \"login\",\r\n            redirectUri,\r\n        },\r\n        discovery,\r\n    );\r\n\r\n    useEffect(() => {\r\n        if (response && \"params\" in response) {\r\n            if (response.params && \"code\" in response.params) {\r\n                // console.log(\"-----------------------\");\r\n                // console.log(response.params.code);\r\n                // console.log(\"-----------------------\");\r\n                // console.log(request.codeVerifier);\r\n                // console.log(\"-----------------------\")\r\n                dispatch(SignIn(response.params.code, request.codeVerifier))\r\n            }\r\n        }\r\n    }, [response]);\r\n\r\n    const signOut = () => {\r\n        dispatch(SignOut())\r\n        setUserData(null)\r\n    }\r\n\r\n    const renderProfile = () => (\r\n        <SafeAreaView>\r\n            <View>\r\n                <Text style={styles.CenterScreenText}>คุณยังไม่ได้เข้าสู่ระบบ</Text>\r\n                <Button\r\n                    title=\"Sign in\"\r\n                    onPress={() => promptAsync()}\r\n                />\r\n            </View>\r\n        </SafeAreaView>\r\n    )\r\n\r\n    return (\r\n        <SafeAreaView style={styles.Container}>\r\n            {\r\n                isLoad ?\r\n                    <Text style={styles.CenterScreenText}>\r\n                        Loading...\r\n                    </Text>\r\n                    :\r\n                    renderProfile()\r\n            }\r\n        </SafeAreaView>\r\n    )\r\n};\r\n\r\nconst styles = StyleSheet.create({\r\n    Container: {\r\n        flex: 1,\r\n        alignItems: 'center',\r\n        justifyContent: 'center',\r\n        backgroundColor: 'white'\r\n    },\r\n    CenterScreenText: {\r\n        textAlign: 'center',\r\n        fontFamily: fonts.bold,\r\n        fontSize: fontSize.primary\r\n    }\r\n});\r\n\r\nexport default ProfileScreen;\r\n"],"mappings":";;;;;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;;;;;;;;AAGA,IAAMA,aAAa,GAAG,SAAhBA,aAAgB,OAAyB;EAAA,IAAvBC,KAAuB,QAAvBA,KAAuB;EAAA,IAAhBC,UAAgB,QAAhBA,UAAgB;;EAC3C,gBAA4B,IAAAC,eAAA,EAAS,IAAT,CAA5B;EAAA;EAAA,IAAOC,MAAP;EAAA,IAAeC,SAAf;;EACA,iBAAgC,IAAAF,eAAA,EAAS,IAAT,CAAhC;EAAA;EAAA,IAAOG,QAAP;EAAA,IAAiBC,WAAjB;;EACA,iBAAkC,IAAAJ,eAAA,EAAS,KAAT,CAAlC;EAAA;EAAA,IAAOK,SAAP;EAAA,IAAkBC,YAAlB;;EACA,IAAMC,SAAS,GAAG,IAAAC,iCAAA,EAAiB,6EAAjB,CAAlB;EACA,IAAMC,WAAW,GAAG,IAAAC,gCAAA,EAAgB;IAACC,MAAM,EAAE;EAAT,CAAhB,CAApB;EACA,IAAMC,QAAQ,GAAG,IAAAC,uBAAA,GAAjB;;EAGA,mBAAkC,IAAAC,uBAAA,EAAY,UAAAC,KAAK;IAAA,OAAIA,KAAK,CAACC,IAAV;EAAA,CAAjB,CAAlC;EAAA,IAAOC,QAAP,gBAAOA,QAAP;EAAA,IAAiBC,aAAjB,gBAAiBA,aAAjB;;EAEA,oBAA+B,IAAAJ,uBAAA,EAAY,UAAAC,KAAK;IAAA,OAAIA,KAAK,CAACI,IAAV;EAAA,CAAjB,CAA/B;EAAA,IAAOC,SAAP,iBAAOA,SAAP;EAAA,IAAkBC,SAAlB,iBAAkBA,SAAlB;;EAqBA,IAAAC,gBAAA,EAAU,YAAM;IACZC,OAAO,CAACC,GAAR,CAAY,aAAZ;IACAZ,QAAQ,CAAC,IAAAa,kBAAA,GAAD,CAAR;EACH,CAHD,EAGG,EAHH;EAKA,IAAAH,gBAAA,EAAW,YAAK;IACZ,IAAGL,QAAQ,KAAK,IAAhB,EAAqB;MACjBS,sBAAA,CAAcC,UAAd,CAAyBV,QAAQ,CAACE,IAAT,CAAcS,KAAvC,EAA8CC,IAA9C,CAAmD,UAAAC,GAAG,EAAI;QACtD,IAAG,CAACA,GAAG,CAACC,IAAJ,CAASC,QAAb,EAAsB;UAClBjC,UAAU,CAACkC,QAAX,CAAoB,aAApB,EAAmC;YAACd,IAAI,EAAEF,QAAQ,CAACE;UAAhB,CAAnC;QACH,CAFD,MAEM,CAEL;MACJ,CAND;IAOH;EASJ,CAlBD,EAkBG,CAACF,QAAD,CAlBH;EAoBA,IAAAK,gBAAA,EAAU,YAAM;IACZ,IAAIF,SAAS,KAAK,IAAlB,EAAwB;MACpB,IAAMc,OAAO,GAAGC,IAAI,CAACC,KAAL,CAAWhB,SAAX,EAAsBc,OAAtC;;MACA,IAAMf,IAAI,GAAGkB,eAAA,CAAOC,GAAP,CAAWJ,OAAX,CAAb;;MACA9B,WAAW,CAACe,IAAD,CAAX;MACAI,OAAO,CAACC,GAAR,CAAYL,IAAZ;IACH;;IACD,IAAIE,SAAJ,EAAe;MACXE,OAAO,CAACC,GAAR,CAAY,uBAAuBH,SAAnC;IACH;;IACDnB,SAAS,CAAC,KAAD,CAAT;EACH,CAXD,EAWG,CAACkB,SAAD,CAXH;;EAaA,sBAAyC,IAAAmB,+BAAA,EACrC;IACIC,QAAQ,EAAE,sCADd;IAEIC,YAAY,EAAE,0CAFlB;IAGIC,MAAM,EAAE,CAAC,QAAD,EAAW,SAAX,EAAsB,OAAtB,EAA+B,gBAA/B,CAHZ;IAIIC,YAAY,EAAE,MAJlB;IAKIC,MAAM,EAAE,OALZ;IAMInC,WAAW,EAAXA;EANJ,CADqC,EASrCF,SATqC,CAAzC;EAAA;EAAA,IAAOsC,OAAP;EAAA,IAAgBC,QAAhB;EAAA,IAA0BC,WAA1B;;EAYA,IAAAzB,gBAAA,EAAU,YAAM;IACZ,IAAIwB,QAAQ,IAAI,YAAYA,QAA5B,EAAsC;MAClC,IAAIA,QAAQ,CAACE,MAAT,IAAmB,UAAUF,QAAQ,CAACE,MAA1C,EAAkD;QAM9CpC,QAAQ,CAAC,IAAAqC,YAAA,EAAOH,QAAQ,CAACE,MAAT,CAAgBE,IAAvB,EAA6BL,OAAO,CAACM,YAArC,CAAD,CAAR;MACH;IACJ;EACJ,CAXD,EAWG,CAACL,QAAD,CAXH;;EAaA,IAAMM,OAAO,GAAG,SAAVA,OAAU,GAAM;IAClBxC,QAAQ,CAAC,IAAAyC,aAAA,GAAD,CAAR;IACAjD,WAAW,CAAC,IAAD,CAAX;EACH,CAHD;;EAKA,IAAMkD,aAAa,GAAG,SAAhBA,aAAgB;IAAA,OAClB,6BAAC,yBAAD;MAAA;MAAA;QAAA;QAAA;QAAA;MAAA;IAAA,GACI,6BAAC,iBAAD;MAAA;MAAA;QAAA;QAAA;QAAA;MAAA;IAAA,GACI,6BAAC,iBAAD;MAAM,KAAK,EAAEC,MAAM,CAACC,gBAApB;MAAA;MAAA;QAAA;QAAA;QAAA;MAAA;IAAA,gJADJ,EAEI,6BAAC,mBAAD;MACI,KAAK,EAAC,SADV;MAEI,OAAO,EAAE;QAAA,OAAMT,WAAW,EAAjB;MAAA,CAFb;MAAA;MAAA;QAAA;QAAA;QAAA;MAAA;IAAA,EAFJ,CADJ,CADkB;EAAA,CAAtB;;EAYA,OACI,6BAAC,yBAAD;IAAc,KAAK,EAAEQ,MAAM,CAACE,SAA5B;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,GAEQxD,MAAM,GACF,6BAAC,iBAAD;IAAM,KAAK,EAAEsD,MAAM,CAACC,gBAApB;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,gBADE,GAKFF,aAAa,EAPzB,CADJ;AAYH,CA5HD;;AA8HA,IAAMC,MAAM,GAAGG,uBAAA,CAAWC,MAAX,CAAkB;EAC7BF,SAAS,EAAE;IACPG,IAAI,EAAE,CADC;IAEPC,UAAU,EAAE,QAFL;IAGPC,cAAc,EAAE,QAHT;IAIPC,eAAe,EAAE;EAJV,CADkB;EAO7BP,gBAAgB,EAAE;IACdQ,SAAS,EAAE,QADG;IAEdC,UAAU,EAAEC,cAAA,CAAMC,IAFJ;IAGdC,QAAQ,EAAEA,iBAAA,CAASC;EAHL;AAPW,CAAlB,CAAf;;eAcexE,a"},"metadata":{},"sourceType":"script"}